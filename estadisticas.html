<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Estad√≠sticas</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body{font-family:Segoe UI,system-ui;padding:18px;background:#f5f6f8;color:#111}
  .card{background:#fff;border-radius:10px;padding:14px;margin-bottom:14px;
        box-shadow:0 2px 8px rgba(0,0,0,0.06)}
  h1{margin:0 0 8px}
  #filters{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  select,input{padding:6px;border-radius:6px;border:1px solid #ddd}
  table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
  .small{font-size:12px;color:#666}
</style>
</head>

<body>
<h1>üìä Estad√≠sticas</h1>

<div class="card small">
  Esta p√°gina usa los datos guardados por tu Index en
  <b>localStorage.registroProcesado</b>.
</div>

<div class="card">
  <div id="filters">
    <select id="filterDia"><option value="">Todos los d√≠as</option></select>
    <select id="filterFecha"><option value="">Todas las fechas</option></select>
    <input id="filterName" placeholder="Buscar actividad" />
    <button id="refreshBtn">üîÅ Actualizar</button>
    <div style="margin-left:auto" id="status" class="small"></div>
  </div>
</div>

<div class="card">
  <h3>Resumen</h3>
  <div id="resumen" class="small"></div>
</div>

<div class="card">
  <h3>Tiempo por actividad</h3>
  <canvas id="chartActividades" height="120"></canvas>
</div>

<div class="card">
  <h3>Tiempo por d√≠a</h3>
  <canvas id="chartDias" height="120"></canvas>
</div>

<div class="card">
  <h3>Sesiones</h3>
  <table>
    <thead>
      <tr>
        <th>Actividad</th>
        <th>D√≠a</th>
        <th>Fecha</th>
        <th>Inicio</th>
        <th>Fin</th>
        <th>Duraci√≥n</th>
        <th>Objetivo (min)</th>
        <th>Cumplido</th>
      </tr>
    </thead>
    <tbody id="tablaSesiones"></tbody>
  </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    // === 1. Carga de la fuente OFICIAL: LAS FILAS DEL REGISTRO ===
    const filas = JSON.parse(localStorage.getItem("registroFilas") || "[]");

    if (!filas || filas.length === 0) {
        document.getElementById("contenedor").innerHTML = "<p>No hay datos en el registro.</p>";
        return;
    }

    // === 2. De estas filas, solo las que indican FIN DE SESI√ìN ===
    const tiposFin = ["timer_pausado", "timer_completado", "timer_reseteado"];
    const sesiones = filas.filter(f => tiposFin.includes(f.tipo));

    // === 3. Convertir HH:MM:SS a segundos ===
    function marcaToSec(str) {
        if (!str) return 0;
        const p = str.split(":").map(Number);
        return p[0] * 3600 + p[1] * 60 + p[2];
    }

    // === 4. Transformaci√≥n de sesiones ===
    const sesionesProcesadas = sesiones.map(f => {
        const durSec = marcaToSec(f.marca);
        const objetivo = Number(f.objetivo) || 0;
        const cumplido = objetivo > 0 ? (durSec >= objetivo * 60) : null;

        return {
            actividad: f.nombre,
            dia: f.dia,
            fecha: f.timestamp.slice(0, 10),
            inicio: null,   // no lo sabemos desde registro (no lo necesitamos)
            fin: f.timestamp,
            durSec,
            durStr: f.marca,
            objetivo,
            cumplido
        };
    });

    // === 5. Render a la tabla ===
    const tbody = document.getElementById("tablaSesionesBody");
    tbody.innerHTML = "";

    sesionesProcesadas.forEach(s => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${s.actividad}</td>
            <td>${s.dia}</td>
            <td>${s.fecha}</td>
            <td>${s.durStr}</td>
            <td>${s.objetivo}</td>
            <td>${s.cumplido === null ? "‚Äî" : (s.cumplido ? "‚úì" : "‚úó")}</td>
        `;

        tbody.appendChild(tr);
    });

});
</script>


</body>
</html>
















